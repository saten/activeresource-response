<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Activeresource-response by Fivell</title>
    
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Activeresource-response</h1>
        <p>Extensions to ActiveResource library. The simpliest way for REST pagination.</p>
        <p class="view"><a href="https://github.com/Fivell/activeresource-response">View the Project on GitHub <small>Fivell/activeresource-response</small></a></p>
        <ul>
          <li><a href="https://github.com/Fivell/activeresource-response/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Fivell/activeresource-response/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Fivell/activeresource-response">Fork On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>Activeresource-response</h3>

<p>This gem adds possibility to access http response object from result (single object or collection) of activeresource call (methods : find, all, first, last, get )</p>

<h3>Why It can be used?</h3>

<p>Such functionallity can be used for easily implementing pagination in a REST API so that an ActiveResource client can navigate paginated results.</p>

<h3>How to use?</h3>

<p>Add dependency to your Gemfile</p>

<div class="highlight">
<pre>  <span class="n">gem</span> <span class="s2">"activeresource-response"</span>
</pre>
</div>


<p>Just open your ActiveResource class  and add </p>

<div class="highlight">
<pre>  <span class="n">add_response_method</span> <span class="ss">:your_method_name</span>
</pre>
</div>


<p>You can add method to ActiveResource::Base to use it in all subclasses</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">ActiveResource</span><span class="o">::</span><span class="no">Base</span>
    <span class="n">add_response_method</span> <span class="ss">:my_response</span>  
  <span class="k">end</span>
</pre>
</div>


<h3>Full example of usage with kaminari gem</h3>

<p>Rest Client</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ActiveResource</span><span class="o">::</span><span class="no">Base</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="ss">:json</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="s1">'<a href="http://0.0.0.0:3000/">http://0.0.0.0:3000/</a>'</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">element_name</span> <span class="o">=</span> <span class="s2">"order"</span> 
    <span class="n">add_response_method</span> <span class="ss">:http_response</span>  <span class="c1"># our new method for returned objects </span>
  <span class="k">end</span>
</pre>
</div>


<p>Server Side</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">OrdersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="vi">@orders</span> <span class="o">=</span> <span class="no">Order</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:per_page</span><span class="o">]</span><span class="p">)</span>
      <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">"X-total"</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@orders</span><span class="o">.</span><span class="n">total_count</span><span class="o">.</span><span class="n">to_s</span>
      <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">"X-offset"</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@orders</span><span class="o">.</span><span class="n">offset_value</span><span class="o">.</span><span class="n">to_s</span>
      <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">"X-limit"</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@orders</span><span class="o">.</span><span class="n">limit_value</span><span class="o">.</span><span class="n">to_s</span>
      <span class="n">respond_with</span><span class="p">(</span><span class="vi">@orders</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre>
</div>


<p>Client Side</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">OrdersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
    <span class="k">def</span> <span class="nf">index</span>
      <span class="n">orders</span> <span class="o">=</span> <span class="no">Order</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="ss">:params</span><span class="o">=&gt;</span><span class="n">params</span><span class="p">)</span>     
      <span class="vi">@orders</span> <span class="o">=</span> <span class="no">Kaminari</span><span class="o">::</span><span class="no">PaginatableArray</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
        <span class="n">orders</span><span class="p">,{</span>
                <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="n">orders</span><span class="o">.</span><span class="n">http_response</span><span class="o">[</span><span class="s1">'X-limit'</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span>
                <span class="ss">:offset</span> <span class="o">=&gt;</span><span class="n">orders</span><span class="o">.</span><span class="n">http_response</span><span class="o">[</span><span class="s1">'X-offset'</span><span class="o">].</span><span class="n">to_i</span><span class="p">,</span>
                <span class="ss">:total_count</span> <span class="o">=&gt;</span> <span class="n">orders</span><span class="o">.</span><span class="n">http_response</span><span class="o">[</span><span class="s1">'X-total'</span><span class="o">].</span><span class="n">to_i</span>
        <span class="p">})</span> 
    <span class="k">end</span>
  <span class="k">end</span>
</pre>
</div>


<h3>Every time when http connection invoked ActiveResource connection object  stores http response. You can access it with http_response method.</h3>

<p>Example</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">Order</span> <span class="o">&lt;</span> <span class="no">ActiveResource</span><span class="o">::</span><span class="no">Base</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="s1">'<a href="http://0.0.0.0:3000/">http://0.0.0.0:3000/</a>'</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">element_name</span> <span class="o">=</span> <span class="s2">"order"</span> 
    <span class="n">add_response_method</span> <span class="ss">:my_response</span>  <span class="c1"># our new method</span>
  <span class="k">end</span>

  <span class="n">orders</span> <span class="o">=</span> <span class="no">Order</span><span class="o">.</span><span class="n">all</span>
  <span class="n">first_order</span> <span class="o">=</span> <span class="no">Order</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
  <span class="n">orders</span><span class="o">.</span><span class="n">my_response</span><span class="o">[</span><span class="s1">'content-length'</span><span class="o">]</span> 
  <span class="c1"># =&gt; "3831" </span>
  <span class="n">first_order</span><span class="o">.</span><span class="n">my_response</span><span class="o">[</span><span class="s1">'content-length'</span><span class="o">]</span> 
  <span class="c1">#=&gt; "260"</span>
  <span class="c1">#connection also always has last http response object , to access it use http_response method</span>
  <span class="no">Order</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">http_response</span><span class="o">.</span><span class="n">to_hash</span>
  <span class="c1"># =&gt; {"content-type"=&gt;["application/json; charset=utf-8"], "x-ua-compatible"=&gt;["IE=Edge"], "etag"=&gt;["\"573cabd02b2f1f90405f7f4f77995fab\""], "cache-control"=&gt;["max-age=0, private, must-revalidate"], "x-request-id"=&gt;["2911c13a0c781044c474450ed789613d"], "x-runtime"=&gt;["0.071018"], "content-length"=&gt;["260"], "server"=&gt;["WEBrick/1.3.1 (Ruby/1.9.2/2011-02-18)"], "date"=&gt;["Sun, 19 Feb 2012 10:21:29 GMT"], "connection"=&gt;["close"]} </span>
</pre>
</div>


<h3>Methods to access headers and cookies</h3>

<p>You can get cookies and headers from response 
Example</p>

<div class="highlight">
<pre>  <span class="k">class</span> <span class="nc">Country</span> <span class="o">&lt;</span> <span class="no">ActiveResource</span><span class="o">::</span><span class="no">Base</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">site</span> <span class="o">=</span> <span class="s1">'<a href="http://0.0.0.0:3000/">http://0.0.0.0:3000/</a>'</span>
    <span class="n">add_response_method</span> <span class="ss">:my_response</span>  <span class="c1"># our new method</span>
  <span class="k">end</span>
  <span class="n">countries</span> <span class="o">=</span> <span class="no">Country</span><span class="o">.</span><span class="n">all</span>
  <span class="n">countries</span><span class="o">.</span><span class="n">my_response</span><span class="o">.</span><span class="n">headers</span>

 <span class="c1"># keys are symbolized =&gt; {:content_type=&gt;["application/json; charset=utf-8"], :x_ua_compatible=&gt;["IE=Edge"], ..., :set_cookie=&gt;["bar=foo; path=/", "foo=bar; path=/"]} </span>


  <span class="n">countries</span><span class="o">.</span><span class="n">my_response</span><span class="o">.</span><span class="n">cookies</span>
 <span class="c1"># =&gt; {"bar"=&gt;"foo", "foo"=&gt;"bar"}   </span>
</pre>
</div>


<h3>About Http response</h3>

<p>http response is object of Net::HTTPOK, Net::HTTPClientError or one of other subclasses
of Net::HTTPResponse class. For more information see documentation  <a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/net/http/rdoc/Net/HTTPResponse.html">http://www.ruby-doc.org/stdlib-1.9.3/libdoc/net/http/rdoc/Net/HTTPResponse.html</a></p>

<h3>Inspirators</h3>

<p><a href="http://phpblog.com.ua/2012/01/rails-activeresource-i-zagolovki/">http://phpblog.com.ua/2012/01/rails-activeresource-i-zagolovki/</a></p>

<p><a href="http://stackoverflow.com/questions/5972429/active-resource-responses-how-to-get-them">http://stackoverflow.com/questions/5972429/active-resource-responses-how-to-get-them</a></p>

<h3>Please, feel free to contact me if you have any questions</h3>

<p>fedoronchuk(at)gmail.com</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/Fivell">Fivell</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>